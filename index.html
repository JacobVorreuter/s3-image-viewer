<html>
  <head>
    <style>
      body {
        font-family: "Helvetica Neue", helvetica, arial;
        padding: 0px;
        margin: 0px;
        margin-top: 8px;
      }

      #images {
        margin: 0;
        padding: 0;
        width: 600px;
      }

      .lbl-cell {
        float: left;
      }

      .image-cell {
        float: left;
        padding-bottom: 10px;
      }
    </style>

    <script>
      // build the WebSocket host by taking the curent page url and replacing http with ws
      // this has the added benefit of supporting both ws and wss depending on the page proto
      var host = location.origin.replace(/^http/, 'ws')
      var ws = new WebSocket(host);

      // this is how we keep track of the last image we've pulled from s3 on the server side
      // it is passed back to the server when requesting the next batch of images
      var marker = '';

      function load_images() {
        ws.send(marker);
        ws.onmessage = function (event) {
          var image_data = JSON.parse(event.data);

          // record the latest image name
          marker = image_data.Marker;

          // append a new label and image to the DOM
          var lbl = document.createElement('div');
          lbl.innerHTML = image_data.Modified;
          lbl.className = 'lbl-cell';

          var img = document.createElement('img');
          img.src = 'data:image/jpeg;base64, ' + image_data.Body;
          img.className = 'image-cell';

          document.querySelector('#images').appendChild(lbl);
          document.querySelector('#images').appendChild(img);
        };
      }

      ws.onopen = function (event) {
        load_images();
      };
    </script>
  </head>
  <body>
    <div id='images'></div>
    <div style="clear:both"></div>
    <br/>
    <a href="javascript:void(0)" onclick="load_images();">LOAD MORE</a></br>
  </body>
</html>
